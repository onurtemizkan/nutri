appId: ${APP_ID}

# Smoke Test Suite
# Description: Quick sanity checks to verify core functionality
# Run time: ~3-5 minutes
# Purpose: Fast validation before deeper testing

---
# Smoke Test 1: Login and Basic Navigation
# Validates: Authentication + Tab Navigation

- launchApp

# Handle location permission dialog if it appears (optional)
- tapOn:
    text: "Don't Allow"
    optional: true

# Wait for app to fully load
- extendedWaitUntil:
    visible: "Sign In"
    timeout: 15000

# Perform login
- tapOn: "Sign In"
- waitForAnimationToEnd:
    timeout: 3000
- tapOn: "Email"
- inputText: "${TEST_EMAIL}"
- tapOn: "Password"
- inputText: "${TEST_PASSWORD}"
- tapOn: "Sign In"
- extendedWaitUntil:
    visible: "Hello"
    timeout: 10000

# Verify authenticated
- assertVisible: "Calories"
- assertVisible: "Today's Meals"

# Cleanup: Logout to ensure clean state for next test
- tapOn: "Profile"
- scroll
- tapOn: "Logout"
- tapOn: "Logout"
- assertVisible: "Sign In"

---
# Smoke Test 2: Add Meal Flow
# Validates: Core meal tracking functionality

- launchApp
- extendedWaitUntil:
    visible: "Sign In"
    timeout: 15000

# Perform login
- tapOn: "Sign In"
- waitForAnimationToEnd:
    timeout: 3000
- tapOn: "Email"
- inputText: "${TEST_EMAIL}"
- tapOn: "Password"
- inputText: "${TEST_PASSWORD}"
- tapOn: "Sign In"
- extendedWaitUntil:
    visible: "Hello"
    timeout: 10000

# Quick meal addition
- tapOn: "Add Meal"
- tapOn: "Breakfast"
- tapOn:
    text: "e.g., Grilled Chicken Salad"
- inputText: "Smoke Test Meal"
- tapOn:
    text: "Calories"
- inputText: "250"
- tapOn:
    text: "Protein"
- inputText: "15"
- tapOn:
    text: "Carbs"
- inputText: "30"
- tapOn:
    text: "Fat"
- inputText: "8"
- tapOn: "Save"

# Verify success
- assertVisible: "Meal added successfully"
- tapOn: "OK"

---
# Smoke Test 3: Profile View and Logout
# Validates: Profile access + Logout flow

- launchApp
- extendedWaitUntil:
    visible: "Sign In"
    timeout: 15000

# Perform login
- tapOn: "Sign In"
- waitForAnimationToEnd:
    timeout: 3000
- tapOn: "Email"
- inputText: "${TEST_EMAIL}"
- tapOn: "Password"
- inputText: "${TEST_PASSWORD}"
- tapOn: "Sign In"
- extendedWaitUntil:
    visible: "Hello"
    timeout: 10000

# Check profile
- tapOn: "Profile"
- assertVisible: "${TEST_NAME}"
- assertVisible: "${TEST_EMAIL}"
- assertVisible: "Daily Goals"

# Quick logout
- scroll
- tapOn: "Logout"
- tapOn: "Logout"

# Verify logged out
- assertVisible: "Nutri"
- assertVisible: "Sign In"

---
# Smoke Test 4: Registration Flow
# Validates: New user signup

- launchApp

# Navigate to signup
- tapOn: "Create Account"
- assertVisible: "Create Account"

# Fill registration (using unique email from environment)
- tapOn: "Name"
- inputText: "${NEW_USER_NAME}"

- tapOn: "Email"
- inputText: "${NEW_USER_EMAIL}"

- tapOn: "Password"
- inputText: "${NEW_USER_PASSWORD}"

- tapOn: "Confirm Password"
- inputText: "${NEW_USER_PASSWORD}"

# Submit
- tapOn: "Create Account"

# Verify success (auto-login)
- extendedWaitUntil:
    visible: "Hello"
    timeout: 10000
