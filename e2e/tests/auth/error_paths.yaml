# Auth Error Path E2E Tests
# Tests error handling and edge cases in authentication flows

appId: host.exp.Exponent

env:
  TEST_USER_EMAIL: "test@nutri-e2e.local"
  TEST_USER_PASSWORD: "TestPass123!"

---

# Test: Sign In with Wrong Password
- runFlow: ../../flows/launch_app.yaml

- tapOn:
    text: "Sign In"
- assertVisible:
    id: "signin-screen"

# Enter valid email but wrong password
- tapOn:
    id: "signin-email-input"
- inputText: ${TEST_USER_EMAIL}

- tapOn:
    id: "signin-password-input"
- inputText: "wrongpassword123"

- tapOn:
    id: "signin-submit-button"

# Should stay on sign in screen (login failed)
- assertVisible:
    id: "signin-screen"

---

# Test: Sign In with Non-existent Account
- runFlow: ../../flows/launch_app.yaml

- tapOn:
    text: "Sign In"
- assertVisible:
    id: "signin-screen"

# Enter non-existent email
- tapOn:
    id: "signin-email-input"
- inputText: "nonexistent@example.com"

- tapOn:
    id: "signin-password-input"
- inputText: "somepassword123"

- tapOn:
    id: "signin-submit-button"

# Should stay on sign in screen
- assertVisible:
    id: "signin-screen"

---

# Test: Sign Up with Existing Email
# Note: This requires the test user to already exist
- runFlow: ../../flows/launch_app.yaml

- tapOn:
    text: "Create Account"
- assertVisible:
    id: "signup-screen"

# Try to sign up with existing email
- tapOn:
    id: "signup-name-input"
- inputText: "Duplicate User"

- tapOn:
    id: "signup-email-input"
- inputText: ${TEST_USER_EMAIL}

- tapOn:
    id: "signup-password-input"
- inputText: ${TEST_USER_PASSWORD}

- tapOn:
    id: "signup-confirm-password-input"
- inputText: ${TEST_USER_PASSWORD}

- tapOn:
    id: "signup-submit-button"

# Should stay on sign up screen (email already exists)
- assertVisible:
    id: "signup-screen"

---

# Test: Rapid Form Submission (Spam Protection)
- runFlow: ../../flows/launch_app.yaml

- tapOn:
    text: "Sign In"
- assertVisible:
    id: "signin-screen"

# Enter credentials
- tapOn:
    id: "signin-email-input"
- inputText: ${TEST_USER_EMAIL}

- tapOn:
    id: "signin-password-input"
- inputText: "wrongpassword"

# Rapid taps should not cause issues
- tapOn:
    id: "signin-submit-button"
- tapOn:
    id: "signin-submit-button"
- tapOn:
    id: "signin-submit-button"

# App should still be responsive
- assertVisible:
    id: "signin-screen"
