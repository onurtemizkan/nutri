# Add Meal E2E Tests
# Tests the complete meal creation flow

appId: host.exp.Exponent

---

# Test: Add Meal with All Required Fields
- runFlow: ../../flows/sign_in_test_user.yaml

- assertVisible:
    id: "home-screen"

# Open add meal screen
- tapOn:
    id: "home-add-meal-fab"

- extendedWaitUntil:
    visible:
      id: "add-meal-screen"
    timeout: 10000

# Scroll down to reach meal name input
- swipe:
    start: "50%,70%"
    end: "50%,40%"
    duration: 300

# Fill in meal details - need to hideKeyboard between inputs
- tapOn:
    id: "add-meal-name-input"
- inputText: "Grilled Chicken Salad"
- hideKeyboard

- tapOn:
    id: "add-meal-calories-input"
- inputText: "450"
- hideKeyboard

- tapOn:
    id: "add-meal-protein-input"
- inputText: "35"
- hideKeyboard

- tapOn:
    id: "add-meal-carbs-input"
- inputText: "20"
- hideKeyboard

- tapOn:
    id: "add-meal-fat-input"
- inputText: "22"
- hideKeyboard

# Save the meal
- tapOn:
    id: "add-meal-save-button"

# Should navigate back to home after success
- extendedWaitUntil:
    visible:
      id: "home-screen"
    timeout: 15000

---

# Test: Add Meal Validation - Empty Fields
- runFlow: ../../flows/sign_in_test_user.yaml

- assertVisible:
    id: "home-screen"

# Open add meal screen
- tapOn:
    id: "home-add-meal-fab"

- extendedWaitUntil:
    visible:
      id: "add-meal-screen"
    timeout: 10000

# Try to save without filling required fields
- tapOn:
    id: "add-meal-save-button"

# Should show error alert - dismiss it
- tapOn:
    text: "OK"
    optional: true

# Should stay on add meal screen
- assertVisible:
    id: "add-meal-screen"

---

# Test: Cancel Adding Meal
- runFlow: ../../flows/sign_in_test_user.yaml

- assertVisible:
    id: "home-screen"

# Open add meal screen
- tapOn:
    id: "home-add-meal-fab"

- extendedWaitUntil:
    visible:
      id: "add-meal-screen"
    timeout: 10000

# Scroll down to reach meal name input
- swipe:
    start: "50%,70%"
    end: "50%,40%"
    duration: 300

# Fill some data
- tapOn:
    id: "add-meal-name-input"
- inputText: "Test Meal"
- hideKeyboard

# Cancel using back button
- tapOn:
    id: "add-meal-cancel-button"

# Should be back on home
- extendedWaitUntil:
    visible:
      id: "home-screen"
    timeout: 10000
